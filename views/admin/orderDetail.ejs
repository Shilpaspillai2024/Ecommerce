<style>
    body{
    background:#eee;
   
    }
.card {
    box-shadow: 0 20px 27px 0 rgb(0 0 0 / 5%);
}
.card {
    position: relative;
    display: flex;
    flex-direction: column;
    min-width: 0;
    word-wrap: break-word;
    background-color: #fff;
    background-clip: border-box;
    border: 0 solid rgba(0,0,0,.125);
    border-radius: 1rem;
 
}
.text-reset {
    --bs-text-opacity: 1;
    color: inherit!important;
}
a {
    color: #5465ff;
    text-decoration: none;
}
.container-fluid{
  padding-left: 250px;
  

}
.container{
  padding-top: 85px;
  padding-bottom: 7rem;
}
</style>



<%-include('navbar')%>
<%-include('sidebar')%>
<div class="container-fluid">

    <div class="container">
      <!-- Title -->
      <div class="d-flex justify-content-between align-items-center py-3">
        <h2 class="h5 mb-0 text-white"><a href="#" class="text-muted"></a> Order #<%=order.orderID%></h2>

        
      </div>
    
      <!-- Main content -->
      <div class="row">
        <div class="col-lg-8">
          <!-- Details -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="mb-3 d-flex justify-content-between">
                <div>

                 
                  <span class="me-3"><%= order.createdAt.toDateString() %></span>
               
                </div>
               
              </div>
         
              <table class="table table-borderless">
  <tbody>
    <% order.products.forEach((product) => { %>
      <tr>
        <td>
          <div class="d-flex mb-2">
            <div class="flex-shrink-0">
              <img src="../../<%= product.productId.productImage[0] %>" alt="" width="35" class="img-fluid">
            </div>
            <div class="flex-lg-grow-1 ms-3">
              <h6><%= product.productId.productName %></h6>
            </div>
          </div>
        </td>

        <!-- Quantity -->
        <td><%= product.quantity %></td>

        <!-- Original Price -->
        <td>₹<%= product.productId.productPrice.toFixed(2) %></td>

        <!-- Product Discount -->
        <td>
          <% if (product.productId.productDiscount && product.productId.productDiscount > 0) {
               const discountAmount = (product.productId.productPrice * product.productId.productDiscount) / 100;
          %>
            <small class="text-success">
              Discount: ₹<%= discountAmount.toFixed(2) %>
            </small>
          <% } else { %>
            <small class="text-muted">No discount</small>
          <% } %>
        </td>

        <!-- Final Price -->
        <td class="text-end">
          ₹<%= (product.price * product.quantity).toFixed(2) %>
        </td>
      </tr>
    <% }) %>
  </tbody>

  <tfoot>
    <tr>
      <td colspan="4">Shipping Charge</td>
      <td class="text-end">₹<%= order.shippingCharge ? order.shippingCharge.toFixed(2) : '0.00' %></td>
    </tr>

    <% if (order.couponDiscount && order.couponDiscount > 0) { %>
      <tr>
        <td colspan="4">Coupon Discount</td>
        <td class="text-end text-success">- ₹<%= order.couponDiscount.toFixed(2) %></td>
      </tr>
    <% } %>

    <tr class="fw-bold">
      <td colspan="3">TOTAL</td>
      <td><%= order.totalQuantity %></td>
      <td class="text-end">₹<%= order.totalPrice.toFixed(2) %></td>
    </tr>
  </tfoot>
</table>

            </div>
          </div>
          <!-- Payment -->
          <div class="card mb-4">
            <div class="card-body">
              <div class="row">
                <div class="col-lg-6">
                  <h3 class="h6">Payment Method</h3>
                  <p><%= order.paymentMethod %><br>
                </div>
                <div class="col-lg-6">
                  <h3 class="h6">shipping address</h3>
                  <address>
                    <strong><%= order.address.contactName %></strong><br>
                    <%= order.address.addressType %><br>
                    <%= order.address.doorNo %><br>
                    <%= order.address.Address %><br>
                    <%= order.address.areaAddress %><br>
                    <%= order.address.landmark %><br>
                    <%= order.address.pincode %><br>
                    
                    
                    <abbr title="Phone">P:</abbr>  <%= order.address.phone %>
                  </address>
                </div>
              </div>
            </div>
          </div>
        </div>
       
        <div class="col-lg-4">
         
          <div class="card mb-4">
            <!-- Shipping information -->
            <div class="card-body">
              <h3 class="h6">Billing Information</h3>
             
              <h3 class="h6">Address</h3>
              <address>
                <strong><%= order.address.contactName %></strong><br>
                <%= order.address.addressType %><br>
                <%= order.address.doorNo %><br>
                <%= order.address.Address %><br>
                <%= order.address.areaAddress %><br>
                <%= order.address.landmark %><br>
                <%= order.address.pincode %><br>
                
               
                <abbr title="Phone">P:</abbr> <%= order.address.phone %>
              </address>
            </div>
          </div>
          <div class="card mb-4">
            
              <div class="card-body">
                <% if(order.status === 'return-pending') {%>
                  <h3>Confirm Order Return</h3>
                  <p>Confirm order successfully returned</p>
                  <div>
                      <a href="/admin/returnOrder/<%= order._id %>" class="btn btn-primary">Confirm</a>
                      <a href="/admin/order" class="btn submit-btn-light">Go Back</a>
                  </div>
              <%}else { %>

                <h3 class="h6">Change Order Status</h3>

                <form action="/admin/edit-order-status/<%= order._id %>" method="post" id="edit-order-status-form">
                
              
                <div class="mb-3">
                  <label for="orderStatus" class="form-label">Order Status</label>
                  <select class="form-select" id="productDeliveryStatus" name="orderStatus">
                      <option value="processing" <%= order.status === 'processing' ? 'selected' : '' %>>Processing</option>
                      <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
                      <option value="shipped" <%= order.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
                      <option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
                      <option value="cancelled" <%= order.status === 'cancelled' ? 'selected' : '' %>>Cancelled</option>
                  </select>
                </div>
              
                <a href="/admin/order" class="btn btn-secondary me-2 ms-2">Go Back</a>
                <button type="submit" class="btn btn-primary ms-2">Update Status</button>
            </div>
            </form>
            <% } %>
        </div>
        </div>
      </div>
      
    </div>
   
      </div>

      <%-include('footer')%>


      <script>
        const editOrderStatusForm=document.getElementById('edit-order-status-form')

        editOrderStatusForm.addEventListener('submit',(e)=>{
            e.preventDefault();

            Swal.fire({
                icon:"question",
                title:"Change Order Status",
                text:"Are you sure want to change the order status",
                 showCancelButton:true,
                confirmButtonText:"Change status"

            }).then((result)=>{
                if(result.isConfirmed){
                    editOrderStatusForm.submit()
                }
            })
        })
      </script>